(()=>{"use strict";const e={en:{greetTr:"Good ",plHolderTr:"enter your name",timesOfDayTr:["night","morning","afternoon","evening"],langTr:"en-US",cityTr:"Minsk",cityPlaceHolderTr:"enter the city",windTr:"wind",humidityTr:"humidity",chooseLangTr:"choose language",chooseSourceTr:"choose photo source",enterBgTemeTr:"background theme",bgPlaceHolderTr:"enter theme",timeTr:"time",dateTr:"date",greetingTr:"greeting",quoteTr:"quote",weatherTr:"weather",audioTr:"audio player",todoTr:"todo",activeTr:"active",completedTr:"completed",deletedTr:"deleted"},ru:{greetTr:"Добр",plHolderTr:"введите ваше имя",timesOfDayTr:["ой ночи","е утро","ый день","ый вечер"],langTr:"ru-RU",cityTr:"Минск",cityPlaceHolderTr:"введите город",windTr:"ветер",humidityTr:"влажность воздуха",chooseLangTr:"выберите язык",chooseSourceTr:"выберите источник фона",enterBgTemeTr:"тема фона",bgPlaceHolderTr:"введите тему",timeTr:"время",dateTr:"дата",greetingTr:"приветствие",quoteTr:"цитата",weatherTr:"погода",audioTr:"аудио плейер",todoTr:"список дел",activeTr:"активные",completedTr:"выполненные",deletedTr:"удалённые"}},t=document.querySelector(".name"),o=document.querySelector(".greeting"),n={value:"en"};function a(n){const a=c(n),r=`${e[n].greetTr}${a}, `;return t.placeholder=`${e[n].plHolderTr}`,o.textContent=r}function c(t){const o=(new Date).getHours(),n=Math.floor(o/6);return e[t].timesOfDayTr.reduce(((e,t,o)=>(o==n&&(e=t),e)))}const r=document.querySelector(".date");function l(t){const o=(new Date).toLocaleDateString(`${e[t].langTr}`,{weekday:"long",month:"long",day:"numeric"});r.textContent=o}function s(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}const d=document.querySelector(".weather-icon"),i=document.querySelector(".temperature"),u=document.querySelector(".weather-description"),m=document.querySelector(".wind"),g=document.querySelector(".humidity"),S=document.querySelector(".city"),y=document.querySelector(".weather-error");async function h(t){localStorage.getItem("city")?S.value=localStorage.getItem("city"):S.value=`${e[t].cityTr}`;const o=`https://api.openweathermap.org/data/2.5/weather?q=${S.value}&lang=${t}&appid=3d3089a958d144a6b08451c705f4ef59&units=metric`,n=await fetch(o),a=await n.json();404==n.status?(y.textContent="Error: city isn't found",i.textContent="",m.textContent="",g.textContent=""):400==n.status?(y.textContent="Error: enter the city",i.textContent="",m.textContent="",g.textContent=""):y.textContent="",S.placeholder=`${e[t].cityPlaceHolderTr}`,d.className="weather-icon owf",d.classList.add(`owf-${a.weather[0].id}`),i.textContent=`${Math.floor(a.main.temp)} °C`,u.textContent=a.weather[0].description,m.textContent=`${e[t].windTr}: ${Math.floor(a.wind.speed)} m/s`,g.textContent=`${e[t].humidityTr}: ${Math.floor(a.main.humidity)} %`}const v=document.querySelector(".quote"),p=document.querySelector(".author");async function T(e){const t=await fetch("quotes.json"),o=await t.json();let n=s(1,29);v.textContent=`${o[e][n].text}`,p.textContent=`${o[e][n].author}`}const q=[{title:"Aqua Caelestis",src:"../images/sounds/Aqua Caelestis.mp3",duration:"00:58"},{title:"River Flows In You",src:"../images/sounds/River Flows In You.mp3",duration:"03:50"},{title:"Ennio Morricone",src:"../images/sounds/Ennio Morricone.mp3",duration:"03:50"},{title:"Summer Wind",src:"../images/sounds/Summer Wind.mp3",duration:"03:50"}],f=document.querySelector(".play"),L=document.querySelector(".play-next"),w=document.querySelector(".play-prev"),x=document.querySelector(".play-list"),I=new Audio;let k=!1,E=0;function $(){I.currentTime=0,I.play(),k=!0}function C(){const e=document.querySelectorAll(".play-item");e.forEach((e=>e.classList.remove("active"))),E==q.length-1?E=0:E+=1,I.src=q[E].src,e[E].classList.add("active"),$(),f.classList.contains("play")&&f.classList.add("pause")}q.forEach(((e,t)=>{(e=document.createElement("li")).classList.add("play-item"),e.textContent=`${q[t].title}`,x.appendChild(e)}));let O=0,b=0,N=0;const H=document.querySelector(".todo-button"),A=document.querySelector(".todo"),M=document.querySelector("#active-option"),P=document.querySelector("#deleted-option"),_=document.querySelector("#completed-option");const G={action(e){const t=e.target;if(t.classList.contains("todo-action")){const e=t.dataset.todoAction,o=t.closest(".todo-item");"deleted"===e&&"deleted"===o.dataset.todoState?o.remove():o.dataset.todoState=e,this.save()}else t.classList.contains("todo-add")&&(this.add(),this.save())},add(){const e=document.querySelector(".todo-text");!e.disabled&&e.value.length&&(document.querySelector(".todo-items").insertAdjacentHTML("beforeend",this.create(e.value)),e.value="")},create:e=>`<li class="todo-item" data-todo-state="active">\n  <span class="todo-task">${e}</span>\n  <span class="todo-action todo-action-restore" data-todo-action="active"></span>\n  <span class="todo-action todo-action-complete" data-todo-action="completed"></span>\n  <span class="todo-action todo-action-delete" data-todo-action="deleted"></span></li>`,init(){const e=localStorage.getItem("todo");e&&(document.querySelector(".todo-items").innerHTML=e),document.querySelector(".todo-options").addEventListener("change",this.update),document.addEventListener("click",this.action.bind(this))},update(){const e=document.querySelector(".todo-options").value;document.querySelector(".todo-items").dataset.todoOption=e,document.querySelector(".todo-text").disabled="active"!==e},save(){localStorage.setItem("todo",document.querySelector(".todo-items").innerHTML)}},U=document.querySelector(".settings"),j=document.querySelector(".settings-button"),D=document.querySelector(".change-language"),J=document.querySelector(".change-photosource"),B=document.querySelector(".choose-background"),R=document.querySelector("#audio"),Y=document.querySelector("#date"),F=document.querySelector("#time"),W=document.querySelector("#quote"),z=document.querySelector("#todo"),K=document.querySelector("#greeting"),Q=document.querySelector("#weather"),V=document.querySelector(".text-choose-language"),X=document.querySelector(".text-choose-photosource"),Z=document.querySelector(".text-choose-background"),ee=document.querySelector(".text-date"),te=document.querySelector(".text-time"),oe=document.querySelector(".text-greeting"),ne=document.querySelector(".text-quotes"),ae=document.querySelector(".text-weather"),ce=document.querySelector(".text-audioplayer"),re=document.querySelector(".text-todo"),le=document.querySelector(".player"),se=document.querySelector(".greeting-container"),de=document.querySelector(".footer-quotes"),ie=document.querySelector(".choose-option-background"),ue=document.querySelector(".weather"),me=document.querySelector(".time");let ge,Se=[Q,R,Y,F,W,z,K],ye=[ue,le,r,me,de,H,se];function he(){Se.forEach(((e,t)=>e.addEventListener("change",(()=>{0==e.checked?ye[t].classList.add("hidden"):ye[t].classList.remove("hidden")})))),pe()}function ve(t){V.textContent=`${e[t].chooseLangTr}`,X.textContent=`${e[t].chooseSourceTr}`,Z.textContent=`${e[t].enterBgTemeTr}`,B.placeholder=`${e[t].bgPlaceHolderTr}`,ee.textContent=`${e[t].dateTr}`,te.textContent=`${e[t].timeTr}`,oe.textContent=`${e[t].greetingTr}`,ne.textContent=`${e[t].quoteTr}`,ae.textContent=`${e[t].weatherTr}`,ce.textContent=`${e[t].audioTr}`,re.textContent=`${e[t].todoTr}`}function pe(){localStorage.setItem("LANGUAGE_OPTION",D.value),localStorage.setItem("PHOTO_SOURCE_OPTION",J.value),localStorage.setItem("BG_THEME",B.value),localStorage.setItem("timeSet",F.checked),localStorage.setItem("dataSet",Y.checked),localStorage.setItem("greetingSet",K.checked),localStorage.setItem("weatherSet",Q.checked),localStorage.setItem("quoteSet",W.checked),localStorage.setItem("audioSet",R.checked),localStorage.setItem("todoSet",z.checked),localStorage.setItem("lang",n.value)}const Te=document.querySelector("body"),qe=document.querySelector(".slide-next"),fe=document.querySelector(".slide-prev"),Le=document.querySelector(".change-quote");let we,xe=s(1,20);function Ie(){const e=(new Date).toLocaleTimeString("en-US",{hour12:!1});me.textContent=e,l(n.value),a(n.value),setTimeout(Ie,1e3)}async function ke(){const e=new Image;let t=c("en"),o=await async function(){let e=c("en"),t=s(1,50);ge=B.value?B.value:e,console.log("flickr bg theme start",ge);let o=`https://www.flickr.com/services/rest/?method=flickr.photos.search&api_key=99db50653f5b2b2c4dfe4766555f1d09&tags=${ge}&extras=url_l&format=json&nojsoncallback=1`;const n=await fetch(o);return(await n.json()).photos.photo[t].url_l}();switch(we=xe<10?xe.toString().padStart(2,0):xe.toString(),J.value){case"github":e.src=`https://raw.githubusercontent.com/rolling-scopes-school/stage1-tasks/assets/images/${t}/${we}.jpg`,ie.classList.remove("visible"),B.value="";break;case"unsplash":ie.classList.remove("visible");break;default:e.src=`${o}`,ie.classList.add("visible")}e.onload=()=>{Te.style.backgroundImage=`url(${e.src})`}}window.addEventListener("load",(function(){localStorage.getItem("LANGUAGE_OPTION")&&(D.value=localStorage.getItem("LANGUAGE_OPTION"),"en"==D.value?n.value="en":n.value="ru"),Ie(),ke(),h(n.value),T(n.value),localStorage.getItem("name")&&(t.value=localStorage.getItem("name")),localStorage.getItem("city")&&(S.value=localStorage.getItem("city")),function(e){let t=JSON.parse(localStorage.getItem("timeSet")),o=JSON.parse(localStorage.getItem("dataSet")),n=JSON.parse(localStorage.getItem("greetingSet")),a=JSON.parse(localStorage.getItem("weatherSet")),c=JSON.parse(localStorage.getItem("quoteSet")),r=JSON.parse(localStorage.getItem("audioSet")),l=JSON.parse(localStorage.getItem("todoSet"));localStorage.getItem("LANGUAGE_OPTION")&&(D.value=localStorage.getItem("LANGUAGE_OPTION")),localStorage.getItem("PHOTO_SOURCE_OPTION")&&(J.value=localStorage.getItem("PHOTO_SOURCE_OPTION")),localStorage.getItem("BG_THEME")&&(B.value=localStorage.getItem("BG_THEME")),F.checked=1==t,Y.checked=1==o,K.checked=!!n,Q.checked=!!a,W.checked=!!c,R.checked=!!r,z.checked=!!l}()})),window.addEventListener("beforeunload",(()=>{localStorage.setItem("name",t.value)})),J.addEventListener("change",ke),B.addEventListener("change",(()=>{console.log("flickr bg theme in input",B.value),ke(),pe()})),qe.addEventListener("click",(function(){xe+=1,21==xe&&(xe=1),ke(),console.log("number of slide is",xe)})),fe.addEventListener("click",(function(){xe-=1,0==xe&&(xe=20),ke(),console.log("number of slide is",xe)})),S.addEventListener("change",(function(e){S.value=e.target.value,console.log("change city",S.value),localStorage.setItem("city",S.value),h(n.value)})),Le.addEventListener("click",(function(){var e;b+=180,(e=Le).style.transform=`rotate(${b}deg)`,e.style.transition="0.6s",T(n.value)})),f.addEventListener("click",(function(){I.src=q[E].src;const e=document.querySelectorAll(".play-item");k?(I.pause(),k=!1,f.classList.toggle("pause"),e[E].classList.remove("active")):($(),f.classList.toggle("pause"),e[E].classList.add("active"))})),L.addEventListener("click",C),w.addEventListener("click",(function(){const e=document.querySelectorAll(".play-item");e.forEach((e=>e.classList.remove("active"))),0==E?E=q.length-1:E-=1,I.src=q[E].src,e[E].classList.add("active"),$(),f.classList.contains("play")&&f.classList.add("pause")})),I.addEventListener("ended",C),j.addEventListener("click",(()=>{!function(e){var t;U.classList.toggle("open"),N+=180,(t=j).style.transform=`rotate(${N}deg)`,t.style.transition="0.6s",ve(e),he()}(n.value)})),U.addEventListener("click",(()=>{he()})),Te.addEventListener("click",(e=>{e.target.closest(".settings")||e.target.closest(".settings-button")||U.classList.remove("open"),e.target.closest(".todo")||e.target.closest(".todo-button")||A.classList.remove("open")})),H.addEventListener("click",(()=>{!function(t){var o;A.classList.toggle("open"),O+=180,(o=H).style.transform=`rotateY(${O}deg)`,o.style.transition="0.6s",M.textContent=`${e[t].activeTr}`,_.textContent=`${e[t].completedTr}`,P.textContent=`${e[t].deletedTr}`}(n.value)})),G.init(),D.addEventListener("change",(function(e){n.value=e.currentTarget.value,console.log("current language -",n.value),h(n.value),console.log("current city.value -",S.value),T(n.value),l(n.value),a(n.value),ve(n.value)}))})();